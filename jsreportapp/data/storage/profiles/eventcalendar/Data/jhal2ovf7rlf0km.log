{"type":"operationStart","subtype":"profile","data":{"_id":"qSXPYJnJLyCxlFg1","timestamp":"2023-01-24T18:22:50.198Z","state":"queued","mode":"standard","creationDate":"2023-01-24T18:22:50.205Z","modificationDate":"2023-01-24T18:22:50.205Z","shortid":"YXdPxuo","$entitySet":"profiles"},"doDiffs":false,"timestamp":1674584570200,"id":"qi7luunn23dur0i","previousOperationId":null,"operationId":"itq1mwtqmhjt2tm"}
{"type":"log","level":"info","message":"Render request 10 queued for execution and waiting for available worker","previousOperationId":"itq1mwtqmhjt2tm","timestamp":1674584570201,"id":"t2mzp8bj3vepuo3"}
{"type":"operationStart","subtype":"render","name":"Data","previousOperationId":"itq1mwtqmhjt2tm","timestamp":1674584570215,"id":"5rjge5fj0kxh3zv","previousEventId":"qi7luunn23dur0i","operationId":"0ek5ddi36juzged"}
{"type":"log","timestamp":1674584570215,"level":"info","message":"Starting rendering request 10","meta":{"rootId":"jhal2ovf7rlf0km","id":"jhal2ovf7rlf0km"},"id":"6stxkainng71u9n","previousOperationId":"0ek5ddi36juzged"}
{"type":"log","timestamp":1674584570215,"level":"info","message":"Rendering template { name: Data, recipe: chrome-pdf, engine: handlebars, preview: true }","meta":{"rootId":"jhal2ovf7rlf0km","id":"jhal2ovf7rlf0km"},"id":"vuzm82skpwf1u85","previousOperationId":"0ek5ddi36juzged"}
{"type":"log","timestamp":1674584570217,"level":"debug","message":"Data item not defined for this template.","meta":{"rootId":"jhal2ovf7rlf0km","id":"jhal2ovf7rlf0km"},"id":"z7jp9mt5twhdng7","previousOperationId":"0ek5ddi36juzged"}
{"type":"log","timestamp":1674584570218,"level":"debug","message":"Executing script testing (beforeRender)","meta":{"rootId":"jhal2ovf7rlf0km","id":"jhal2ovf7rlf0km"},"id":"g4ts3zutxz6va8m","previousOperationId":"0ek5ddi36juzged"}
{"type":"log","timestamp":1674584570230,"level":"warn","message":"Error when processing render request 10\n(because) error when evaluating custom script /eventcalendar/testing\nUnexpected token 'async'\nsandbox.js:66\n    async function afterRender(req, res) {\n    ^^^^^\n\nSyntaxError: Unexpected token 'async'\n    at new Script (node:vm:100:7)\n    at doCompileScript (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:224:14)\n    at run (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:169:72)\n    at WorkerReporter._runInSandbox (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:180:20)\n    at WorkerReporter.runInSandbox (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:152:17)\n    at async executeScript (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:25:5)","meta":{"rootId":"jhal2ovf7rlf0km","id":"jhal2ovf7rlf0km"},"id":"xxa1rmfa65lib4h","previousOperationId":"0ek5ddi36juzged"}
{"type":"log","timestamp":1674584570230,"level":"warn","message":"Rendering request 10 finished with error in 33 ms","meta":{"rootId":"jhal2ovf7rlf0km","id":"jhal2ovf7rlf0km"},"id":"9bruftpp15ok38c","previousOperationId":"0ek5ddi36juzged"}
{"type":"error","timestamp":1674584570236,"statusCode":400,"weak":true,"entity":{"shortid":"W0gvNctphZ","name":"testing","content":"// Use the \"beforeRender\" or \"afterRender\" hook\n// to manipulate and control the report generation\nconst axios = require('axios');\nconst nodemailer = require('nodemailer')\n\nasync function beforeRender(req, res) {\n    const r = await axios.get('http://localhost:3000/events')\n    req.data.events = { ...req.data,\n        ...r.data\n    }\n    console.log(req.data.events)\n\n    const response = await axios.get('http://localhost:3000/locations')\n    req.data.locations = { ...req.data,\n        ...response.data\n    }\n    console.log(req.data.locations)\n\n    const responseEventType = await axios.get('http://localhost:3000/event_types')\n    req.data.eventType = { ...req.data,\n        ...responseEventType.data\n    }\n    console.log(req.data.eventType)\n\n    // const responseUser = await axios.get('http://localhost:3000/users')    \n    // req.data.user = { ...req.data, ...responseUser.data}\n    // console.log(req.data.user)\n  const smtpTransport = nodemailer.createTransport({\n            service: 'gmail',\n            auth: {\n                user: 'jdejohan@gmail.com',\n                pass: 'tlpbeqiyxipbpwsx'\n            }\n        })\n\n\n        const mail = {\n            from: 'jdejohan@gmail.com',\n            to: \"johansantanagalvan.job@gmail.com\",\n            subject: 'CRUD report',\n            text: '...',\n            attachments: [{\n                filename: 'Data.pdf',\n                content: new Buffer(res.content)\n            }],\n        }\n\n        try {\n            await smtpTransport.sendMail(mail, function(error, info) {\n                    if (error) {\n                        console.log(error);\n                    } else {\n                        console.log('Email sent: ' + info.response);\n                        // do something useful\n                    }\n            });\n        }\n            finally {\n                smtpTransport.close()\n            }\n        }\n\n\n}\n    \n    async function afterRender(req, res) {\n      \n\n    }"},"property":"content","logged":true,"previousOperationId":"0ek5ddi36juzged","id":"yismvmaqx3wl2su","stack":"sandbox.js:66\n    async function afterRender(req, res) {\n    ^^^^^\n\nSyntaxError: Unexpected token 'async'\n    at new Script (node:vm:100:7)\n    at doCompileScript (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:224:14)\n    at run (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\createSandbox.js:169:72)\n    at WorkerReporter._runInSandbox (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\sandbox\\runInSandbox.js:180:20)\n    at WorkerReporter.runInSandbox (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\reporter.js:152:17)\n    at async executeScript (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-scripts\\lib\\executeScript.js:122:12)\n    at async Scripts._runScript (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:140:30)\n    at async Scripts.handleBeforeRender (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-scripts\\lib\\worker.js:64:7)\n    at async ListenerCollection.fire (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\shared\\listenerCollection.js:157:21)\n    at async beforeRender (C:\\Users\\Johan\\Desktop\\clases\\Proyecto\\Calendar-Event\\jsreportapp\\node_modules\\@jsreport\\jsreport-core\\lib\\worker\\render\\render.js:25:5)","message":"Error when evaluating custom script /eventcalendar/testing\nUnexpected token 'async'"}
